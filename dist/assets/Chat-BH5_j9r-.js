import{j as e,u as re,r as t,a as oe,b as P,s as G,_ as L,c as z,h as ie,l as ae,f as ce,d as le,e as de,i as me,k as ue,C as ge,m as pe,n as fe,S as he,o as N,g as xe,T as je,I as ye,p as ve,q as D,t as O,N as $,A as Me}from"./index-irexueTV.js";import{A as Ae}from"./AppLayout-IchV62e4.js";import{M as Se,a as be}from"./Menu-Bt0IaSNa.js";import{M as k,L as F}from"./MenuItem-DnPP-E3C.js";import{T as E}from"./Tooltip-CVusUE4k.js";import{c as S,T as I}from"./Typography-JwG0Pq1m.js";import{R as Ce}from"./RenderAttachment-CQ0cw_Za.js";import{B as Le,u as Te,a as ke}from"./Menu-CmgIRgBM.js";import{F as Fe}from"./index-DH6ci2QH.js";import{I as B}from"./IconButton-DwQ1NlaF.js";import"./ExitToApp-5YtZ6gSP.js";import"./Delete-BaecR_Mp.js";import"./AvatarCard-8JM5A-wH.js";import"./Avatar-Cp4DZ0XV.js";import"./Modal-CTaQcr3u.js";import"./Toolbar-CXjODSla.js";import"./Notifications-BCCyyApQ.js";const Ee=S(e.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),Ve=S(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 11h-3v3.75c0 1.24-1.01 2.25-2.25 2.25S8.5 17.99 8.5 16.75s1.01-2.25 2.25-2.25c.46 0 .89.14 1.25.38V11h4zm-3-4V3.5L18.5 9z"}),"AudioFile"),Ie=S(e.jsx("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2M8.5 13.5l2.5 3.01L14.5 12l4.5 6H5z"}),"Image"),Re=S(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),we=S(e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm4 18H6V4h7v5h5zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile"),He=S(e.jsx("path",{d:"M14 2H6.01c-1.1 0-2 .89-2 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8zm-1 7V3.5L18.5 9zm1 5 2-1.06v4.12L14 16v1c0 .55-.45 1-1 1H9c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h4c.55 0 1 .45 1 1z"}),"VideoFile"),_e=({anchorE1:n,chatId:i})=>{const{isFileMenu:a}=re(s=>s.misc),c=t.useRef(null),g=t.useRef(null),o=t.useRef(null),u=t.useRef(null),[p]=oe(),f=()=>{var s;return(s=c.current)==null?void 0:s.click()},x=()=>{var s;return(s=g.current)==null?void 0:s.click()},l=()=>{var s;return(s=o.current)==null?void 0:s.click()},j=()=>{var s;return(s=u.current)==null?void 0:s.click()},y=P(),T=()=>y(G(!1)),v=async(s,h)=>{const b=Array.from(s.target.files);if(b.length<=0)return;if(b.length>5)return L.error(`you can only send 5 ${h} at a time`);y(z(!0));const M=L.loading(`Sending ${h}...`);T();try{const d=new FormData;d.append("chatId",i),b.forEach(A=>d.append("files",A)),(await p(d)).data?L.success(`${h} sent successfully`,{id:M}):L.error(`falied to send ${h}`,{id:M})}catch(d){L.error(d,{id:M})}finally{y(z(!1))}};return e.jsx(Se,{anchorE1:n,open:a,onClose:T,children:e.jsx("div",{style:{width:"10rem"},children:e.jsxs(be,{children:[e.jsxs(k,{onClick:f,children:[e.jsx(E,{title:"Image",children:e.jsx(Ie,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Image"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/png, image/jpeg, image/gif",style:{display:"none"},onChange:s=>v(s,"Images"),ref:c})]}),e.jsxs(k,{onClick:x,children:[e.jsx(E,{title:"Audio",children:e.jsx(Ve,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Audio"}),e.jsx("input",{type:"file",multiple:!0,accept:"audio/mpeg, audio/wav",style:{display:"none"},onChange:s=>v(s,"Audios"),ref:g})]}),e.jsxs(k,{onClick:l,children:[e.jsx(E,{title:"Video",children:e.jsx(He,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"Video"}),e.jsx("input",{type:"file",multiple:!0,accept:"video/mp4, video/webm, video/ogg",style:{display:"none"},onChange:s=>v(s,"Videos"),ref:o})]}),e.jsxs(k,{onClick:j,children:[e.jsx(E,{title:"File",children:e.jsx(we,{})}),e.jsx(F,{style:{marginLeft:"0.5rem"},children:"File"}),e.jsx("input",{type:"file",multiple:!0,accept:"*",style:{display:"none"},onChange:s=>v(s,"Files"),ref:u})]})]})})})},ze=({message:n,user:i})=>{const{sender:a,content:c,attachments:g=[],createdAt:o}=n,u=(a==null?void 0:a._id)===(i==null?void 0:i._id),p=ie(o).fromNow();return e.jsxs("div",{style:{alignSelf:u?"flex-end":"flex-start",backgroundColor:"white",color:"black",borderRadius:"5px",padding:"0.5rem",width:"fit-content"},children:[!u&&e.jsx(I,{color:ae,fontWeight:"600",variant:"caption",children:a.name}),c&&e.jsx(I,{children:c}),g.length>0&&g.map((f,x)=>{const l=f.url,j=ce(l);return e.jsx(Le,{children:e.jsx("a",{href:l,target:"_blank",download:!0,style:{color:"black"},children:Ce(j,l)})},x)}),e.jsx(I,{variant:"caption",color:"text.secondary",children:p})]})},Ne=t.memo(ze),De=({chatId:n,user:i})=>{var R,w,H,_;const a=t.useRef(null),c=t.useRef(null),g=le(),o=de(),u=P(),[p,f]=t.useState(""),[x,l]=t.useState([]),[j,y]=t.useState(1),[T,v]=t.useState(null),[s,h]=t.useState(!1),[b,M]=t.useState(!1),d=t.useRef(null),m=me({chatId:n,skip:!n}),A=ue({chatId:n,page:j}),{data:U,setData:Y}=Fe(a,(R=A.data)==null?void 0:R.totalPages,j,y,(w=A.data)==null?void 0:w.message),C=(_=(H=m==null?void 0:m.data)==null?void 0:H.chat)==null?void 0:_.members,Q=[{isError:m.isError,error:m.error},{isError:A.isError,error:A.error}],W=r=>{f(r.target.value),s||(o.emit(D,{members:C,chatId:n}),h(!0)),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{o.emit(O,{members:C,chatId:n}),h(!1)},[1e3])},q=r=>{u(G(!0)),v(r.currentTarget)},J=r=>{r.preventDefault(),p.trim()&&(o.emit($,{chatId:n,members:C,message:p}),f(""))};t.useEffect(()=>(o.emit(ge,{userId:i._id,members:C}),u(pe(n)),()=>{l([]),f(""),Y([]),y(1),o.emit(fe,{userId:i._id,members:C})}),[n]),t.useEffect(()=>{c.current&&c.current.scrollIntoView({behavior:"smooth"})},[x]),t.useEffect(()=>{if(m.isError)return g("/")},[m.isError]);const X=t.useCallback(r=>{r.chatId===n&&l(V=>[...V,r.message])},[n]),K=t.useCallback(r=>{r.chatId===n&&M(!0)},[n]),Z=t.useCallback(r=>{r.chatId===n&&M(!1)},[n]),ee=t.useCallback(r=>{const V={content:r,sender:{_id:"dbvfdbsnjfvbff",name:"Admin"},chat:n,createdAt:new Date().toISOString()};l(ne=>[...ne,V])},[n]),se={[Me]:ee,[$]:X,[D]:K,[O]:Z};Te(o,se),ke(Q);const te=[...U,...x];return m.isLoading?e.jsx(he,{}):e.jsxs(t.Fragment,{children:[e.jsxs(N,{ref:a,boxSizing:"border-box",padding:"1rem",spacing:"1rem",bgcolor:xe,height:"90%",sx:{overflowX:"hidden",overflowY:"auto"},children:[te.map(r=>e.jsx(Ne,{message:r,user:i},r._id)),b&&e.jsx(je,{}),e.jsx("div",{ref:c})]}),e.jsx("form",{style:{height:"10%"},onSubmit:J,children:e.jsxs(N,{direction:"row",height:"100%",padding:"1rem",alignItems:"center",position:"relative",children:[e.jsx(B,{sx:{position:"absolute",left:"1.5rem",rotate:"30deg"},onClick:q,children:e.jsx(Ee,{})}),e.jsx(ye,{placeholder:"Type Message here...",value:p,onChange:W}),e.jsx(B,{type:"submit",sx:{rotate:"-30deg",bgcolor:ve,color:"white",marginLeft:"1rem",padding:"0.5rem","&:hover":{bgcolor:"error.dark"}},children:e.jsx(Re,{})})]})}),e.jsx(_e,{anchorE1:T,chatId:n})]})},ns=Ae()(De);export{ns as default};
